<?xml version="1.0"?>

<custom-sql>

    <!-- Finds all users in the database and joins them with settings table -->
    <sql id="com.marcelmika.lims.persistence.generated.service.persistence.SettingsFinder.findAllUsers">
        <![CDATA[
			SELECT
				User_.userId AS userId,
				User_.screenName AS screenName,
				User_.firstName AS firstName,
				User_.middleName AS middleName,
				User_.lastName AS lastName,
				Lims_Settings.status AS status
			FROM
				Lims_Settings
			INNER JOIN
				User_ ON (User_.userId = Lims_Settings.userId)
			WHERE
				User_.userId != ?
				[$DEFAULT_USER$]
			ORDER BY
				User_.firstName ASC,
				User_.middleName ASC,
				User_.lastName ASC
		]]>
    </sql>

    <!-- Finds all users and attaches groups to them -->
    <sql id="com.marcelmika.lims.persistence.generated.service.persistence.SettingsFinder.findByUsersGroups">
        <![CDATA[
			SELECT DISTINCT
			    Group_.name AS groupName,
				User_.userId AS userId,
				User_.screenName AS screenName,
				User_.firstName AS firstName,
				User_.middleName AS middleName,
				User_.lastName AS lastName,
				Lims_Settings.status AS status
			FROM
				Lims_Settings
			INNER JOIN
				User_ ON (User_.userId = Lims_Settings.userId)
			INNER JOIN
				Users_Groups ON (Users_Groups.userId = User_.userId)
			INNER JOIN
			    Group_ ON (Users_Groups.groupId = Group_.groupId)
			WHERE
				(Users_Groups.groupId IN
					(
						SELECT
							Users_Groups.groupId
						FROM
							Users_Groups [$USERS_GROUPS_JOIN$]
						WHERE
							(userId = ?) [$USERS_GROUPS_WHERE$]
					)
				)
				AND	(User_.userId != ?)
				[$DEFAULT_USER$]
			ORDER BY
				User_.firstName ASC,
				User_.middleName ASC,
				User_.lastName ASC
		]]>
    </sql>

</custom-sql>